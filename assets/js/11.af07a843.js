(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{377:function(t,a,e){"use strict";e.r(a);var s=e(47),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"create-a-hello-world-project"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-a-hello-world-project"}},[t._v("#")]),t._v(" Create a hello world project")]),t._v(" "),e("p",[t._v("to create a new scala project you can use this command "),e("code",[t._v("sbt new scala/hello-world.g8")]),t._v(". This require to have sbt already installed.")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ sbt new scala/hello-world.g8\n")])])]),e("p",[t._v("Use "),e("code",[t._v("hello-world")]),t._v(" as application name.")]),t._v(" "),e("p",[t._v("This will generate the following tree")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ tree hello-world/\nhello-world/\n├── build.sbt\n├── project\n│   └── build.properties\n└── src\n    └── main\n        └── scala\n            └── Main.scala\n")])])]),e("h2",{attrs:{id:"run-the-hello-world-project"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#run-the-hello-world-project"}},[t._v("#")]),t._v(" Run the hello world project")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ sbt run\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("launcher"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" getting org.scala-sbt sbt "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.3")]),t._v(".2  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("this may take some "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\ndownloading https://repo1.maven.org/maven2/org/scala-sbt/sbt/1.3.2/sbt-1.3.2.jar "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   Compilation completed "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(".27s.\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("info"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" running Main \nHello, World"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])]),e("h2",{attrs:{id:"package-the-application"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#package-the-application"}},[t._v("#")]),t._v(" Package the application")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("JavaAppPackaging")]),t._v(" archetype from "),e("code",[t._v("sbt-native-packager")]),t._v(" provides a default application structure and executable scripts to launch your application.")]),t._v(" "),e("p",[t._v("Add the "),e("code",[t._v("sbt-native-packager")]),t._v(" to your "),e("code",[t._v("plugins.sbt")]),t._v(" (Create a new one under project folder)")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('addSbtPlugin("com.typesafe.sbt" % "sbt-native-packager" % "1.7.1")\n')])])]),e("p",[t._v("Enable the JavaAppPackaging plugin in your "),e("code",[t._v("build.sbt")]),t._v(" with")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("enablePlugins(JavaAppPackaging)\n")])])]),e("p",[t._v("This can be done using the following command.")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ sbt stage\n")])])]),e("p",[t._v("The result is available under "),e("code",[t._v("target/universal/stage")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ tree ./target/universal/stage/\n./target/universal/stage/\n├── bin\n│   ├── hello-world\n│   └── hello-world.bat\n└── lib\n    ├── ch.epfl.scala.hello-world-1.0.jar\n    ├── org.scala-lang.scala-library-2.13.1.jar\n    ├── org.typelevel.cats-core_2.13-2.0.0.jar\n    ├── org.typelevel.cats-kernel_2.13-2.0.0.jar\n    └── org.typelevel.cats-macros_2.13-2.0.0.jar\n")])])]),e("p",[t._v("Test the generated script")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" ./target/universal/stage/bin/hello-world\nHello, World"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])]),e("p",[t._v("The usage below show some useful option already available into generated script, like :")]),t._v(" "),e("ul",[e("li",[t._v("verbose and debug options")]),t._v(" "),e("li",[t._v("a multi main class support")]),t._v(" "),e("li",[t._v("selection of java version to use")]),t._v(" "),e("li",[t._v("JVM options")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" target/universal/stage/bin/hello-world -h\nUsage:  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  -h "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" -help         print this message\n  -v "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" -verbose      this runner is chattier\n  -d "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" -debug        "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" debug output "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the launcher script\n  -no-version-check  Don t run the java version check.\n  -main "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("classname"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  Define a custom main class\n  -jvm-debug "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("port"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  Turn on JVM debugging, "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),t._v(" at the given port.\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# java version (default: java from PATH, currently openjdk version "11.0.7" 2020-04-14)')]),t._v("\n  -java-home "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("         alternate JAVA_HOME\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# jvm options and output control")]),t._v("\n  JAVA_OPTS          environment variable, "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("unset")]),t._v(" uses "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  -Dkey"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("val          pass -Dkey"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("val directly to the java runtime\n  -J-X               pass option -X directly to the java runtime\n                     "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("-J is stripped"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# special option")]),t._v("\n  --                 To stop parsing built-in commands from the rest of the command-line.\n                     e.g."),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" enabling debug and sending -d as app argument\n                     $ ./start-script -d -- -d\n\nIn the "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" of duplicated or conflicting options, basically the order above\nshows precedence: JAVA_OPTS lowest, "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" line options highest except "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\nAvailable main classes:\n\tMain\n\n")])])]),e("h2",{attrs:{id:"generate-a-docker-image-for-the-application"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#generate-a-docker-image-for-the-application"}},[t._v("#")]),t._v(" Generate a docker image for the application")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("Docker Plugin")]),t._v(" from "),e("code",[t._v("sbt-native-packager")]),t._v(" implement the following features")]),t._v(" "),e("ul",[e("li",[t._v("generate a Dockerfile based on "),e("code",[t._v("JavaAppPackaging")]),t._v(" archetype stage.")]),t._v(" "),e("li",[t._v("sbt integration to build the docker image")])]),t._v(" "),e("p",[t._v("Enable the Docker Plugin in your "),e("code",[t._v("build.sbt")]),t._v(" with")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("enablePlugins(DockerPlugin)\n")])])]),e("p",[t._v("Run this command to generate a Dockerfile")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ sbt docker:stage\n")])])]),e("p",[t._v("You can see into below the tree of generated files")]),t._v(" "),e("ul",[e("li",[t._v("stage 1 : script and dependencies lib")]),t._v(" "),e("li",[t._v("stage 2 : the application jar")]),t._v(" "),e("li",[t._v("the Dockerfile")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ tree target/docker/stage/\ntarget/docker/stage/\n├── "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n│   └── opt\n│       └── docker\n│           ├── bin\n│           │   ├── hello-world\n│           │   └── hello-world.bat\n│           └── lib\n│               ├── org.scala-lang.scala-library-2.13.1.jar\n│               ├── org.typelevel.cats-core_2.13-2.0.0.jar\n│               ├── org.typelevel.cats-kernel_2.13-2.0.0.jar\n│               └── org.typelevel.cats-macros_2.13-2.0.0.jar\n├── "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n│   └── opt\n│       └── docker\n│           └── lib\n│               └── ch.epfl.scala.hello-world-1.0.jar\n└── Dockerfile\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" directories, "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" files\n")])])]),e("p",[t._v("Let's comment the content of the Dockerfile")]),t._v(" "),e("div",{staticClass:"language-docker extra-class"},[e("pre",{pre:!0,attrs:{class:"language-docker"}},[e("code",[t._v("$ more target/docker/stage/Dockerfile \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# A multi stage Dockerfile")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the first stage named `stage0` based on `openjdk:8`")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" openjdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8 as stage0\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# some meta data")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LABEL")]),t._v(" snp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("multi"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("stage="),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"intermediate"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LABEL")]),t._v(" snp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("multi"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("stage"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("id="),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2240a3f8-0c82-46f2-8c84-fdd8d43c83f0"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# change to /opt/docker folder")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /opt/docker\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# copy target/docker/stage/1/opt from host to /1/opt into container")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" 1/opt /1/opt\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# copy target/docker/stage/2/opt from host to /2/opt into container")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" 2/opt /2/opt\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# run following command as `root`")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USER")]),t._v(" root\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# make /1/opt/docker read only")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chmod"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-R"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"u=rX,g=rX"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/1/opt/docker"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# make /2/opt/docker read only")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chmod"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-R"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"u=rX,g=rX"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/2/opt/docker"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# add execution right to the generated script ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chmod"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"u+x,g+x"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/1/opt/docker/bin/hello-world"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the second stage named `mainstage` based also on `openjdk:8`")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" openjdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8 as mainstage\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USER")]),t._v(" root\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# create a demiourgos728 user with id 1001")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" id "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("u demiourgos728 1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/dev/null 2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("&1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" (( getent group 0 1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/dev/null 2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("&1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" ( type groupadd 1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/dev/null 2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("&1 && groupadd "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("g 0 root "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" addgroup "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("g 0 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("S root )) && ( type useradd 1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/dev/null 2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("&1 && \nuseradd "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("create"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("home "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("uid 1001 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gid 0 demiourgos728 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" adduser "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("S "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("u 1001 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("G root demiourgos728 ))\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /opt/docker\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# copy the content of /1/opt/docker and /2/opt/docker from stage0 into /opt/docker of the mainstage")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from=stage0 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("chown=demiourgos728"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("root /1/opt/docker /opt/docker\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("from=stage0 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("chown=demiourgos728"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("root /2/opt/docker /opt/docker\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# use the created user to run the final docker image")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USER")]),t._v(" 1001"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("0\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# set the hello-world script as an entrypoint of the final docker image")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/opt/docker/bin/hello-world"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),e("p",[t._v("To build the docker image run the following command")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ sbt docker:publishLocal\n")])])]),e("p",[t._v("The result is a docker image named with the same name as the project and with the same version as the project.")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ docker image "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nREPOSITORY                  TAG                     IMAGE ID            CREATED             SIZE\nhello-world                 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("                     e2585c330c0c        "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" seconds ago      525MB\n")])])]),e("p",[t._v("Launch this command to test")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ docker run --rm -ti hello-world:1.0\nHello, World!\n")])])]),e("h2",{attrs:{id:"optimise-the-docker-image"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#optimise-the-docker-image"}},[t._v("#")]),t._v(" Optimise the docker image")]),t._v(" "),e("p",[t._v("The generated docker image have 525MB, let try to optimise this size.\nThe docker history give as the size of each layer. Here we use grep to get only layer that the size is above or equals 1MB.\nThe third column of this output show the Dockerfile command that generate this layer.\nIf we check the Dockerfile we can see that only the first command "),e("code",[t._v("COPY --chown=demiourgos728")]),t._v(" is present.\nThe other command come from the "),e("code",[t._v("openjdk:8")]),t._v(" base image")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ docker "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("history")]),t._v(" hello-world:1.0 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" MB\nc4658e3633a0        "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" minutes ago      /bin/sh -c "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#(nop) COPY --chown=demiourgos728…   13.9MB              ")]),t._v("\n6cedfea72886        "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" weeks ago         /bin/sh -c "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" -eux"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("dpkgArch")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v('"'),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$(")]),t._v("dpkg --pr…   206MB               \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("missing"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" weeks ago         /bin/sh -c "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" -eux"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  apt-g…   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(".1MB              \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("missing"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" weeks ago         /bin/sh -c "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" install…   146MB               \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("missing"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" weeks ago         /bin/sh -c "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" -ex"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -v gpg "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /…   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(".5MB              \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("missing"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" weeks ago         /bin/sh -c "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" install…   "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(".5MB              \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("missing"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" weeks ago         /bin/sh -c "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#(nop) ADD file:f086177965196842a…   114MB")]),t._v("\n")])])]),e("p",[t._v("In fact "),e("code",[t._v("openjdk:8")]),t._v(" base image have 510MB as size")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ docker image "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" openjdk "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8 "')]),t._v("\nopenjdk                     "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("                       6cedfea72886        "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" weeks ago         510MB\n")])])]),e("p",[t._v("Below a list of some openjdk image and we can see that "),e("code",[t._v("adoptopenjdk")]),t._v(" jre version the smallest one")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('$ docker image ls | grep openjdk | grep "jdk" | sort -h -k7\nadoptopenjdk                11.0.7_10-jre-hotspot   015147d37319        2 weeks ago         227MB\nopenjdk                     11.0.7-jre              faf75cb9edb2        2 weeks ago         285MB\nadoptopenjdk                11.0.7_10-jdk-hotspot   6995882bb329        2 weeks ago         420MB\nopenjdk                     jre                     6b23d41384f9        13 months ago       479MB\nopenjdk                     8                       6cedfea72886        2 weeks ago         510MB\nopenjdk                     11.0.7                  f5de33dc9079        2 weeks ago         627MB\n\n')])])]),e("p",[t._v("The "),e("code",[t._v("Docker Plugin")]),t._v(" provide an option to override the base image.")]),t._v(" "),e("p",[t._v("Add this line in your "),e("code",[t._v("build.sbt")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('dockerBaseImage := "adoptopenjdk:11.0.7_10-jre-hotspot"\n')])])]),e("p",[t._v("and run again")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("sbt docker:publishLocal\n")])])]),e("p",[t._v("Verify that the base image has changed into Dockerfile")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("more")]),t._v(" target/docker/stage/Dockerfile "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" FROM\nFROM adoptopenjdk:11.0.7_10-jre-hotspot as stage0\nFROM adoptopenjdk:11.0.7_10-jre-hotspot as mainstage\n")])])]),e("p",[t._v("The new generated docker image is 54% smaller")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ docker image "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" \nREPOSITORY                  TAG                     IMAGE ID            CREATED             SIZE\nhello-world                 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("                     7f8b21413d44        "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" seconds ago      241MB\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                  e2585c330c0c        "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v(" minutes ago      525MB\n")])])]),e("blockquote",[e("p",[t._v("run "),e("code",[t._v("docker image prune -f")]),t._v(" to remove all dangling images.")])]),t._v(" "),e("p",[t._v("Check that application still working")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ docker run --rm -ti hello-world:1.0\nHello, World"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])]),e("p",[t._v("By default, sbt Native Packager will create a daemon user named demiourgos728.\nTo change name of the user, add this line in your "),e("code",[t._v("build.sbt")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('daemonUser in Docker    := "daemon"\n')])])]),e("h2",{attrs:{id:"source-code"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#source-code"}},[t._v("#")]),t._v(" Source code")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/mohamedelhabib/hello-world-scala-docker",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/mohamedelhabib/hello-world-scala-docker"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"references"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References")]),t._v(" "),e("p",[t._v("See more options into :")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://sbt-native-packager.readthedocs.io/en/stable/formats/docker.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Plugin Documentation"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://sbt-native-packager.readthedocs.io/en/stable/archetypes/java_app/index.html#java-app-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java Application Archetype"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);